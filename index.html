<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>App Playa ‚Äì Prototipo</title>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
  :root {
    --primary: #1e88e5;
    --secondary: #ffb300;
    --accent: #4fc3f7;
    --sand: #f5e8c7;
    --ocean: #e1f5fe;
    --dark: #1a237e;
    --success: #43a047;
  }

  * { box-sizing: border-box; }

  body {
    background: linear-gradient(135deg, var(--ocean) 0%, #e0f2f1 50%, var(--sand) 100%);
    min-height: 100vh;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    overflow-x: hidden;
  }

  .app-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    color: white;
    padding: 2.5rem 0;
    position: relative;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(30,136,229,0.4);
  }

  .app-header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
    animation: float 6s ease-in-out infinite;
  }

  .app-title {
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 800;
    text-shadow: 0 4px 12px rgba(0,0,0,0.3);
    margin: 0;
    position: relative;
    z-index: 1;
  }

  .app-subtitle {
    font-size: 1.3rem;
    opacity: 0.95;
    margin: 0.75rem 0 0;
    font-weight: 400;
    position: relative;
    z-index: 1;
  }

  @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-20px) rotate(180deg); } }

  .role-card {
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    border: none;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    height: 240px;
    position: relative;
    overflow: hidden;
  }

  .role-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s;
  }

  .role-card:hover::before { left: 100%; }
  .role-card:hover { transform: translateY(-15px) scale(1.05); box-shadow: 0 30px 60px rgba(30,136,229,0.4); }

  .role-icon {
    font-size: 3.5rem;
    margin-bottom: 1rem;
  }

  .view { display: none; }
  .view.active { display: block; animation: fadeIn 0.5s ease-out; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

  #map {
    height: 500px;
    border-radius: 25px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.25);
    border: 4px solid rgba(255,255,255,0.9);
    backdrop-filter: blur(10px);
    margin-bottom: 2rem;
  }

  .carpero-section {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(20px);
    border-radius: 25px;
    padding: 2.5rem;
    box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    border: 1px solid rgba(255,255,255,0.3);
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
  }

  .carpero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
  }

  .nav-tabs { border: none; margin-bottom: 2.5rem; justify-content: center; }
  .nav-tabs .nav-link {
    border-radius: 20px;
    border: none;
    margin: 0 0.5rem;
    padding: 1rem 2rem;
    background: rgba(245,232,199,0.6);
    color: var(--dark);
    font-weight: 600;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .nav-tabs .nav-link.active {
    background: linear-gradient(135deg, var(--primary), var(--accent));
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(30,136,229,0.4);
  }

  .stat-card {
    background: linear-gradient(135deg, rgba(255,255,255,0.9), var(--ocean));
    border-radius: 20px;
    border: none;
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    transition: all 0.4s ease;
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255,255,255,0.5);
  }

  .stat-card:hover { transform: translateY(-10px) scale(1.02); box-shadow: 0 25px 60px rgba(30,136,229,0.3); }



  .stat-number {
    font-size: 3rem;
    font-weight: 900;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;

    margin: 0;
  }

  .btn {


    border-radius: 25px;
    padding: 0.875rem 2rem;
    font-weight: 700;
    border: none;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--accent));
    box-shadow: 0 8px 25px rgba(30,136,229,0.4);
  }

  .btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(30,136,229,0.6);
  }

  .btn-success {
    background: linear-gradient(135deg, var(--success), #66bb6a);
    box-shadow: 0 8px 25px rgba(67,160,71,0.4);


  }

  .beach-wave {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 120px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M0,56.5c0,0,298.666,0,399,0S1142.5,0,1142.5,0S1150.567,56.5,1200,56.5v44.5H0Z' fill='%23f5e8c7' opacity='0.9'/%3E%3C/svg%3E");
    z-index: -1;
    animation: wave 20s linear infinite;
  }

  @keyframes wave {
    0% { transform: translateX(0) translateZ(0) scaleY(1); }
    50% { transform: translateX(-25%) translateZ(0) scaleY(0.55); }
    100% { transform: translateX(-50%) translateZ(0) scaleY(1); }
  }

  .form-control, .form-select {
    border-radius: 15px;
    border: 2px solid rgba(255,255,255,0.5);
    padding: 0.75rem 1rem;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
  }

  .form-control:focus, .form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.2rem rgba(30,136,229,0.25);
    transform: translateY(-2px);
  }

  .table {
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }

  .table th { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; }
  .table td { border-color: rgba(0,0,0,0.05); }

  @media (max-width: 768px) {
    .app-title { font-size: 2.2rem; }
    #map { height: 400px; }
    .carpero-section { padding: 2rem 1.5rem; margin-bottom: 1.5rem; }
    .nav-tabs .nav-link { padding: 0.75rem 1.25rem; margin: 0 0.25rem; }
  }
</style>

</head>
<body>
  <div id="loader" style="
    position:fixed; inset:0; background:#e1f5fe;
    display:flex; align-items:center; justify-content:center;
    z-index:9999;
  ">
  <div class="spinner-border text-primary" role="status" style="width:3rem;height:3rem;">
    <span class="visually-hidden">Cargando...</span>
  </div>
</div>

  <div class="container py-4">

    <div class="app-header text-center">
  <h1 class="app-title">üèñÔ∏è PlayaHub</h1>
  <p class="app-subtitle">Organiza tu trabajo en las playas</p>
</div>
<div class="beach-wave"></div>

    <!-- Pantalla de inicio -->
    <div id="view-home" class="view active">
      <h1 class="mb-3 text-center">Prototipo PlayaHub</h1>
      <p class="text-center mb-4">
        Elige c√≥mo quieres entrar a la app.
      </p>
      <div class="row justify-content-center">
        <div class="col-md-4 mb-3">
          <div
            class="card role-card"
            onclick="enterAsCarpero()"
          >
            <div class="card-body text-center p-4">
  <div class="role-icon">üèñÔ∏è</div>
  <h3 class="card-title mb-2">Soy vendedor</h3>
  <p class="card-text mb-0">Registrar productos, ventas y ver mi perfil</p>
</div>

          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div
            class="card role-card"
            onclick="enterAsClient()"
          >
            <div class="card-body text-center p-4">
  <div class="role-icon">üó∫Ô∏è</div>
  <h3 class="card-title mb-2">Soy cliente</h3>
  <p class="card-text mb-0">Encontrar vendedores en el mapa</p>
</div>

          </div>
        </div>
      </div>
    </div>

    <!-- Portal Carpero -->
    <div id="view-carpero" class="view">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Panel de vendedor</h2>
        <button class="btn btn-outline-secondary btn-sm" onclick="goHome()">Cerrar sesi√≥n</button>
      </div>

      <!-- Navegaci√≥n interna del portal carpero -->
      <ul class="nav nav-tabs mb-3">
        <li class="nav-item">
          <button class="nav-link active" id="tab-dashboard" onclick="showCarperoSection('dashboard')">
            Dashboard
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" id="tab-productos" onclick="showCarperoSection('productos')">
            Productos
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" id="tab-ventas" onclick="showCarperoSection('ventas')">
            Ventas
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" id="tab-aprende" onclick="showCarperoSection('aprende')">
            Aprende
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" id="tab-perfil" onclick="showCarperoSection('perfil')">
            Perfil
          </button>
        </li>
      </ul>

      <!-- Secci√≥n Dashboard -->
      <div id="carpero-dashboard" class="carpero-section">
        <div class="row">
          <div class="col-md-4 mb-3">
            <div class="card">
              <div class="card-body">
                <h5>Total ventas del d√≠a</h5>
                <p id="total-dia" class="fs-4 fw-bold">$0</p>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="card">
              <div class="card-body">
                <h5>N√∫mero de ventas</h5>
                <p id="num-ventas" class="fs-4 fw-bold">0</p>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="card">
              <div class="card-body">
                <h5>Productos registrados</h5>
                <p id="num-productos" class="fs-4 fw-bold">0</p>
              </div>
            </div>
          </div>
        </div>

        <h4 class="mt-4">Ventas recientes</h4>
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Cant.</th>
              <th>Monto</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody id="tabla-ventas-recientes">
          </tbody>
        </table>
      </div>

      <!-- Secci√≥n Productos -->
      <div id="carpero-productos" class="carpero-section d-none">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4>Mis productos y servicios</h4>
          <button class="btn btn-primary btn-sm" onclick="openProductoForm()">+ Agregar producto</button>
        </div>

        <!-- Formulario producto -->
        <form id="form-producto" class="border rounded p-3 mb-3 d-none" onsubmit="guardarProducto(event)">
          <div class="row">
            <div class="col-md-4 mb-2">
              <label class="form-label">Nombre</label>
              <input type="text" id="prod-nombre" class="form-control" required />
            </div>
            <div class="col-md-3 mb-2">
              <label class="form-label">Tipo</label>
              <select id="prod-tipo" class="form-select" required>
                <option value="bien">Bien</option>
                <option value="servicio">Servicio</option>
              </select>
            </div>
            <div class="col-md-3 mb-2">
              <label class="form-label">Precio (COP)</label>
              <input type="number" id="prod-precio" class="form-control" required />
            </div>
            <div class="col-md-2 mb-2">
              <label class="form-label">Activo</label>
              <select id="prod-activo" class="form-select">
                <option value="true" selected>S√≠</option>
                <option value="false">No</option>
              </select>
            </div>
            <div class="col-12 mb-2">
              <label class="form-label">Descripci√≥n</label>
              <textarea id="prod-desc" class="form-control" rows="2"></textarea>
            </div>
          </div>
          <button type="submit" class="btn btn-success btn-sm">Guardar</button>
          <button type="button" class="btn btn-outline-secondary btn-sm" onclick="cancelProductoForm()">Cancelar</button>
        </form>

        <!-- Lista productos -->
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Tipo</th>
              <th>Precio</th>
              <th>Activo</th>
            </tr>
          </thead>
          <tbody id="tabla-productos">
          </tbody>
        </table>
      </div>

      <!-- Secci√≥n Ventas -->
      <div id="carpero-ventas" class="carpero-section d-none">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4>Registrar venta</h4>
        </div>
        <form id="form-venta" class="border rounded p-3 mb-3" onsubmit="guardarVenta(event)">
          <div class="row">
            <div class="col-md-4 mb-2">
              <label class="form-label">Producto</label>
              <select id="venta-producto" class="form-select" required>
              </select>
            </div>
            <div class="col-md-2 mb-2">
              <label class="form-label">Cantidad</label>
              <input type="number" id="venta-cantidad" class="form-control" value="1" min="1" required />
            </div>
            <div class="col-md-3 mb-2">
              <label class="form-label">Precio unitario (COP)</label>
              <input type="number" id="venta-precio" class="form-control" required />
            </div>
            <div class="col-md-3 mb-2">
              <label class="form-label">Fecha</label>
              <input type="date" id="venta-fecha" class="form-control" required />
            </div>
          </div>
          <button type="submit" class="btn btn-success btn-sm">Guardar venta</button>
        </form>
        
        <div id="comprobante-box" class="alert alert-light border rounded-3 mt-3 d-none">
  <h5 class="mb-2">Comprobante de la √∫ltima venta</h5>
  <pre id="comprobante-texto" class="mb-2" style="white-space: pre-wrap;"></pre>
  <button type="button" class="btn btn-success btn-sm" onclick="copiarComprobante()">
    Copiar texto para WhatsApp
  </button>
</div>

        <h4>Historial de ventas</h4>
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Cant.</th>
              <th>Monto</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody id="tabla-ventas-historial">
          </tbody>
        </table>
      </div>

      <!-- Secci√≥n Aprende -->
      <div id="carpero-aprende" class="carpero-section d-none">
  <h4>Aprende y mejora tu negocio</h4>
  <p class="text-muted">
    Consejos r√°pidos para atender mejor a tus clientes, ganar m√°s dinero y aprovechar bien esta aplicaci√≥n.
  </p>

  <h5 class="mt-3">Atenci√≥n al cliente en playa</h5>
  <ul>
    <li>Saluda siempre con respeto y una sonrisa. Pres√©ntate y explica con calma lo que ofreces, sin presionar al turista.</li>
    <li>Muestra tus precios antes de empezar el servicio para evitar malentendidos y discusiones al final.</li>
    <li>Mant√©n tu zona ordenada (carpas, sillas, nevera) para transmitir confianza y profesionalismo.</li>
    <li>Escucha las quejas con calma y ofrece una soluci√≥n sencilla (descuento, cambio de producto, unos minutos extra de servicio).</li>
  </ul>

  <h5 class="mt-3">C√≥mo aumentar tus ingresos</h5>
  <ul>
    <li>Ofrece combos, por ejemplo: carpa + 2 sillas + 2 bebidas a un precio paquete que sea atractivo.</li>
    <li>Identifica tus productos de mayor ganancia (por ejemplo bebidas fr√≠as) y procura tener siempre stock disponible.</li>
    <li>Aprovecha las horas pico de la playa (ma√±ana y tarde) teniendo todo listo antes de que lleguen los clientes.</li>
    <li>Anota tus gastos del d√≠a (hielo, transporte, ayudantes) y comp√°ralos con las ventas para saber si realmente est√°s ganando.</li>
  </ul>

  <h5 class="mt-3">C√≥mo usar esta app a tu favor</h5>
  <ul>
    <li>Registra cada venta apenas la hagas; as√≠ el total del d√≠a ser√° confiable y podr√°s ver en qu√© d√≠as vendes m√°s.</li>
    <li>Revisa con frecuencia qu√© productos casi no se venden y decide si debes bajar el precio, mejorar la oferta o comprar menos.</li>
    <li>Usa el comprobante de venta para enviar un resumen claro al cliente por WhatsApp y demostrar seriedad en tu trabajo.</li>
    <li>Actualiza tu perfil con una buena descripci√≥n y ubicaci√≥n correcta para que m√°s clientes te encuentren en el mapa.</li>
  </ul>
</div>

      <!-- Secci√≥n Perfil -->
      <div id="carpero-perfil" class="carpero-section d-none">
        <h4>Mi perfil</h4>
        <p class="text-muted">
          Estos datos se usar√°n para mostrarte en el mapa a los clientes.
        </p>
        <form id="form-perfil" class="border rounded p-3" onsubmit="guardarPerfil(event)">
          <div class="row">
            <div class="col-md-4 mb-2">
              <label class="form-label">Nombre comercial</label>
              <input type="text" id="perfil-nombre" class="form-control" required />
            </div>
            <div class="col-md-4 mb-2">
              <label class="form-label">Categor√≠a principal</label>
              <select id="perfil-categoria" class="form-select" required>
                <option value="Carpas">Carpas y sillas</option>
                <option value="Comidas">Comidas y bebidas</option>
                <option value="Masajes">Masajes</option>
                <option value="Tours">Tours y paseos</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
            <div class="col-md-4 mb-2">
              <label class="form-label">WhatsApp (solo n√∫meros)</label>
              <input type="text" id="perfil-whatsapp" class="form-control" placeholder="57XXXXXXXXXX" />
            </div>
            <div class="col-12 mb-2">
              <label class="form-label">Descripci√≥n corta</label>
              <textarea id="perfil-desc" class="form-control" rows="2"></textarea>
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label">Latitud (aprox.)</label>
              <input type="number" step="0.000001" id="perfil-lat" class="form-control" placeholder="10.4..." />
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label">Longitud (aprox.)</label>
              <input type="number" step="0.000001" id="perfil-lng" class="form-control" placeholder="-75.5..." />
            </div>
          </div>
          <button type="submit" class="btn btn-success btn-sm">Guardar perfil</button>
        </form>
      </div>
    </div>

    <!-- Portal Cliente / Turista -->
    <div id="view-cliente" class="view">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Explorar carperos en la playa</h2>
        <button class="btn btn-outline-secondary btn-sm" onclick="goHome()">Volver al inicio</button>
      </div>

      <div class="row mb-3">
        <div class="col-md-4">
          <label class="form-label">Filtrar por categor√≠a</label>
          <select id="filtro-categoria" class="form-select" onchange="renderMapa()">
            <option value="Todos">Todos</option>
            <option value="Carpas">Carpas y sillas</option>
            <option value="Comidas">Comidas y bebidas</option>
            <option value="Masajes">Masajes</option>
            <option value="Tours">Tours y paseos</option>
            <option value="Otro">Otro</option>
          </select>
        </div>
      </div>

      <div id="map" class="mb-3"></div>

      <h4>Lista de vendedores</h4>
      <ul id="lista-carperos" class="list-group"></ul>
    </div>

  </div>

  <!-- Bootstrap JS -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  ></script>
  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // ====== Datos REALES CARTAGENA (playas y carperos t√≠picos) ======
// ====== Datos REALES CARTAGENA ======
let perfilCarpero = {
  nombre: "Carpas Don Chucho",
  categoria: "Carpas", 
  whatsapp: "573044066468",
  desc: "Carpas y sillas en Bocagrande.",
  lat: 10.3975,  // ‚úÖ Playa real
  lng: -75.5625
};

let productos = [
  {id: 1, nombre: "Carpa full d√≠a", tipo: "servicio", precio: 85000, desc: "Carpa grande + 4 sillas todo el d√≠a.", activo: true},
  {id: 2, nombre: "Coco fresco", tipo: "bien", precio: 5000, desc: "Coco fr√≠o reci√©n cortado.", activo: true},
  {id: 3, nombre: "Agua fr√≠a 600ml", tipo: "bien", precio: 3500, desc: "Agua embotellada fr√≠a.", activo: true},
  {id: 4, nombre: "Jugo natural", tipo: "bien", precio: 8000, desc: "Jugo de lulo o guan√°bana.", activo: true},
  {id: 5, nombre: "Masaje 30 min", tipo: "servicio", precio: 30000, desc: "Masaje relajante en la playa.", activo: true}
];

let carperosData = [
  {nombre: "Carpas Don Chucho", categoria: "Carpas", whatsapp: "573044066468", desc: "Carpas Bocagrande.", lat: 10.3997, lng: -75.5625},  // ‚úÖ Bocagrande playa
  {nombre: "La Carpa Dorada", categoria: "Carpas", whatsapp: "573044066468", desc: "Carpas Bocagrande.", lat: 10.4000, lng: -75.5590},   // ‚úÖ Bocagrande zona 2
  {nombre: "Jugos T√≠o Memo", categoria: "Comidas", whatsapp: "573146688739", desc: "Castillo Grande.", lat: 10.4230, lng: -75.5500},    // ‚úÖ Castillo Grande
  {nombre: "Masajes Marina", categoria: "Masajes", whatsapp: "573239632285", desc: "Playa Blanca.", lat: 10.3940, lng: -75.5620},       // ‚úÖ Playa Blanca
  {nombre: "Sombrillas El Laguito", categoria: "Carpas", whatsapp: "573239632285", desc: "Alquiler de carpas y sillas en El Laguito. Zona familiar y tranquila.", lat: 10.3945, lng: -75.5665},
  {nombre: "Ceviches Don Rafa", categoria: "Comidas", whatsapp: "573239632285", desc: "Ceviches y cocteles de camar√≥n frente al mar en Bocagrande.", lat: 10.4008, lng: -75.5568},
  {nombre: "Tours Isla Bar√∫ Express", categoria: "Tours", whatsapp: "573044066468", desc: "Tours de d√≠a completo a Playa Blanca y Bar√∫ desde Cartagena.", lat: 10.4135, lng: -75.5480},
  {nombre: "Helados Do√±a Marta", categoria: "Comidas", whatsapp: "573044066468", desc: "Paletas y helados artesanales en Castillogrande.", lat: 10.4215, lng: -75.5510},
  {nombre: "Kayaks Castillogrande", categoria: "Tours", whatsapp: "573146688739", desc: "Alquiler de kayaks y paddle en Castillogrande.", lat: 10.4210, lng: -75.5485}
];

let ventas = [
  {id: 1, productoId: 2, cantidad: 8, precioUnit: 5000, fecha: new Date().toISOString().slice(0, 10), montoTotal: 40000},
  {id: 2, productoId: 1, cantidad: 2, precioUnit: 85000, fecha: new Date().toISOString().slice(0, 10), montoTotal: 170000}
];

let nextProductoId = 6;
let nextVentaId = 3;

    // ====== Navegaci√≥n entre vistas principales ======
    function formatCOP(valor) {
      return new Intl.NumberFormat('es-CO', {
        style: 'currency',
        currency: 'COP',
        maximumFractionDigits: 0
      }).format(valor);
    }

    
    function showView(id) {
      document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    function goHome() {
      showView("view-home");
    }

    function enterAsCarpero() {
      showView("view-carpero");
      updateCarperoUI();
    }

    function enterAsClient() {
      showView("view-cliente");
      initMap();
    }

    // ====== Navegaci√≥n secciones carpero ======
    function showCarperoSection(section) {
      document.querySelectorAll(".carpero-section").forEach(s => s.classList.add("d-none"));
      document.getElementById("carpero-" + section).classList.remove("d-none");

      document.querySelectorAll("#view-carpero .nav-link").forEach(btn => btn.classList.remove("active"));
      document.getElementById("tab-" + section).classList.add("active");
    }

    // ====== Productos ======
    function openProductoForm() {
      document.getElementById("form-producto").classList.remove("d-none");
    }

    function cancelProductoForm() {
      document.getElementById("form-producto").reset();
      document.getElementById("form-producto").classList.add("d-none");
    }

    function guardarProducto(e) {
      e.preventDefault();
      const nombre = document.getElementById("prod-nombre").value;
      const tipo = document.getElementById("prod-tipo").value;
      const precio = parseFloat(document.getElementById("prod-precio").value || "0");
      const desc = document.getElementById("prod-desc").value;
      const activo = document.getElementById("prod-activo").value === "true";

      productos.push({
        id: nextProductoId++,
        nombre,
        tipo,
        precio,
        desc,
        activo
      });

      cancelProductoForm();
      renderProductos();
      fillProductosEnVentas();
      updateCarperoUI();
    }

    function renderProductos() {
      const tbody = document.getElementById("tabla-productos");
      tbody.innerHTML = "";
      productos.forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.nombre}</td>
          <td>${p.tipo}</td>
          <td>$${p.precio.toLocaleString("es-CO")}</td>
          <td>${p.activo ? "S√≠" : "No"}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ====== Ventas ======
    function fillProductosEnVentas() {
      const sel = document.getElementById("venta-producto");
      sel.innerHTML = "";
      productos
        .filter(p => p.activo)
        .forEach(p => {
          const opt = document.createElement("option");
          opt.value = p.id;
          opt.textContent = p.nombre;
          sel.appendChild(opt);
        });
    }

    function guardarVenta(e) {
      e.preventDefault();
      const productoId = parseInt(document.getElementById("venta-producto").value);
      const cantidad = parseInt(document.getElementById("venta-cantidad").value || "1");
      const precioUnit = parseFloat(document.getElementById("venta-precio").value || "0");
      const fecha = document.getElementById("venta-fecha").value;

      const montoTotal = cantidad * precioUnit;

      ventas.push({
        id: nextVentaId++,
        productoId,
        cantidad,
        precioUnit,
        fecha,
        montoTotal
      });

      document.getElementById("form-venta").reset();
      fillProductosEnVentas();
      renderVentas();
      generarComprobante({
        productoId,
        cantidad,
        precioUnit,
        fecha,
        montoTotal
  });      updateCarperoUI();
    }
    
    function generarComprobante(venta) {
      const prod = productos.find(p => p.id === venta.productoId);
      const nombreProd = prod ? prod.nombre : "Producto";
      const fecha = venta.fecha;
      const texto =
        "Comprobante de venta - Playa Hub\n" +
        "--------------------------------\n" +
        "Producto: " + nombreProd + "\n" +
        "Cantidad: " + venta.cantidad + "\n" +
        "Precio unitario: " + formatCOP(venta.precioUnit) + "\n" +
        "Total: " + formatCOP(venta.montoTotal) + "\n" +
        "Fecha: " + fecha + "\n\n" +
        "¬°Gracias por tu compra!";
      
      const box = document.getElementById("comprobante-box");
      const pre = document.getElementById("comprobante-texto");
      pre.textContent = texto;
      box.classList.remove("d-none");
    }

    function copiarComprobante() {
      const texto = document.getElementById("comprobante-texto").textContent;
      if (!texto) return;
      navigator.clipboard.writeText(texto).then(() => {
        alert("Comprobante copiado. P√©galo en WhatsApp para enviarlo al cliente.");
      });
    }

    function renderVentas() {
      const tbodyHist = document.getElementById("tabla-ventas-historial");
      const tbodyRec = document.getElementById("tabla-ventas-recientes");
      tbodyHist.innerHTML = "";
      tbodyRec.innerHTML = "";

      ventas.forEach(v => {
        const prod = productos.find(p => p.id === v.productoId);
        const nombreProd = prod ? prod.nombre : "Producto";

        const trHist = document.createElement("tr");
        trHist.innerHTML = `
          <td>${nombreProd}</td>
          <td>${v.cantidad}</td>
          <td>$${v.montoTotal.toLocaleString("es-CO")}</td>
          <td>${v.fecha}</td>
        `;
        tbodyHist.appendChild(trHist);
      });

      const recientes = ventas.slice(-5).reverse();
      recientes.forEach(v => {
        const prod = productos.find(p => p.id === v.productoId);
        const nombreProd = prod ? prod.nombre : "Producto";

        const trRec = document.createElement("tr");
        trRec.innerHTML = `
          <td>${nombreProd}</td>
          <td>${v.cantidad}</td>
          <td>$${v.montoTotal.toLocaleString("es-CO")}</td>
          <td>${v.fecha}</td>
        `;
        tbodyRec.appendChild(trRec);
      });
    }

    // ====== Perfil ======
    function guardarPerfil(e) {
      e.preventDefault();
      perfilCarpero.nombre = document.getElementById("perfil-nombre").value;
      perfilCarpero.categoria = document.getElementById("perfil-categoria").value;
      perfilCarpero.whatsapp = document.getElementById("perfil-whatsapp").value;
      perfilCarpero.desc = document.getElementById("perfil-desc").value;
      perfilCarpero.lat = parseFloat(document.getElementById("perfil-lat").value || perfilCarpero.lat);
      perfilCarpero.lng = parseFloat(document.getElementById("perfil-lng").value || perfilCarpero.lng);

      alert("Perfil guardado (prototipo). Ahora se reflejar√° en el mapa del cliente.");
    }

    function cargarPerfilEnFormulario() {
      document.getElementById("perfil-nombre").value = perfilCarpero.nombre || "";
      document.getElementById("perfil-categoria").value = perfilCarpero.categoria || "Carpas";
      document.getElementById("perfil-whatsapp").value = perfilCarpero.whatsapp || "";
      document.getElementById("perfil-desc").value = perfilCarpero.desc || "";
      document.getElementById("perfil-lat").value = perfilCarpero.lat || "";
      document.getElementById("perfil-lng").value = perfilCarpero.lng || "";
    }

    // ====== Dashboard carpero ======
    function updateCarperoUI() {
      // Totales simples del d√≠a (usando fecha de hoy)
      const hoy = new Date().toISOString().slice(0, 10);
      const ventasHoy = ventas.filter(v => v.fecha === hoy);
      const totalDia = ventasHoy.reduce((acc, v) => acc + v.montoTotal, 0);

      document.getElementById("total-dia").textContent = "$" + totalDia.toLocaleString("es-CO");
      document.getElementById("num-ventas").textContent = ventasHoy.length.toString();
      document.getElementById("num-productos").textContent = productos.length.toString();

      renderProductos();
      fillProductosEnVentas();
      renderVentas();
      cargarPerfilEnFormulario();
    }

    // ====== Mapa Leaflet (vista cliente) ======
    let map;
    let markersLayer;

    function initMap() {
  if (!map) {
    map = L.map("map").setView([10.4100, -75.5700], 13);  // ‚úÖ Centro Cartagena

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: '¬© OpenStreetMap'
    }).addTo(map);

    markersLayer = L.layerGroup().addTo(map);
  }
  renderMapa();  // ‚úÖ Cargar todos los carperos
}

    function renderMapa() {
  if (!map || !markersLayer) return;

  markersLayer.clearLayers();
  const categoriaFiltro = document.getElementById("filtro-categoria").value;

  const lista = document.getElementById("lista-carperos");
  lista.innerHTML = "";

  // ‚úÖ MOSTRAR TODOS los carperos de carperosData
  carperosData.forEach(c => {
    if (!c.lat || !c.lng) return;
    if (categoriaFiltro !== "Todos" && c.categoria !== categoriaFiltro) return;

    const marker = L.marker([c.lat, c.lng]).addTo(markersLayer);
    const popupHtml = `
      <strong>${c.nombre}</strong><br/>
      ${c.categoria}<br/>
      ${c.desc}<br/>
      <a href="${buildWhatsAppLink(c.whatsapp)}" target="_blank" class="btn btn-success btn-sm">WhatsApp</a>
    `;
    marker.bindPopup(popupHtml);

    const li = document.createElement("li");
    li.className = "list-group-item";
    li.innerHTML = `
      <div class="d-flex justify-content-between">
        <div>
          <strong>${c.nombre}</strong><br/>
          <small>${c.categoria} ‚Ä¢ ${c.desc}</small>
        </div>
        <a href="${buildWhatsAppLink(c.whatsapp)}" target="_blank" class="btn btn-success btn-sm">Contactar</a>
      </div>
    `;
    lista.appendChild(li);
  });

  // Centrar mapa en Cartagena
  map.setView([10.4100, -75.5700], 13);
}

    function buildWhatsAppLink(number) {
      if (!number) return "#";
      // Formato click-to-chat de WhatsApp
      return "https://wa.me/" + number;
    }

    // ====== Inicializar ======
    document.addEventListener("DOMContentLoaded", () => {
      updateCarperoUI();
      const loader = document.getElementById("loader");
      if (loader) {
        setTimeout(() => {
          loader.style.display = "none";
        }, 2000); // 2000 ms = 2 segundos
      }
    });
  </script>
</body>
</html>
